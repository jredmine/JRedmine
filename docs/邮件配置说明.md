# 邮件配置说明

## 概述

本文档说明如何配置邮件服务器以支持密码重置功能。**本地环境可以发送到真实邮箱**，只要配置了正确的SMTP服务器信息即可。

## 支持的邮件服务商

### 1. QQ邮箱

```yaml
spring:
  mail:
    host: smtp.qq.com
    port: 587
    username: your-email@qq.com  # 你的QQ邮箱
    password: your-authorization-code  # QQ邮箱授权码（不是登录密码）
    default-encoding: UTF-8
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
```

**获取QQ邮箱授权码：**
1. 登录QQ邮箱
2. 设置 → 账户 → 开启SMTP服务
3. 生成授权码（16位字符）

### 2. 163邮箱

```yaml
spring:
  mail:
    host: smtp.163.com
    port: 465  # 或 994
    username: your-email@163.com
    password: your-authorization-code  # 163邮箱授权码
    default-encoding: UTF-8
    properties:
      mail:
        smtp:
          auth: true
          ssl:
            enable: true
            required: true
```

**获取163邮箱授权码：**
1. 登录163邮箱
2. 设置 → POP3/SMTP/IMAP → 开启SMTP服务
3. 生成授权码

### 3. Gmail

```yaml
spring:
  mail:
    host: smtp.gmail.com
    port: 587
    username: your-email@gmail.com
    password: your-app-password  # Gmail应用专用密码
    default-encoding: UTF-8
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
```

**获取Gmail应用专用密码：**
1. 登录Google账户
2. 安全性 → 两步验证 → 应用专用密码
3. 生成应用专用密码（16位字符）

### 4. 企业邮箱（示例：腾讯企业邮箱）

```yaml
spring:
  mail:
    host: smtp.exmail.qq.com
    port: 587
    username: your-email@company.com
    password: your-password  # 企业邮箱登录密码
    default-encoding: UTF-8
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
```

## 配置步骤

### 1. 修改配置文件

编辑 `src/main/resources/application-dev.yml` 或 `application-local.yml`：

```yaml
spring:
  mail:
    host: smtp.qq.com  # 根据你的邮箱服务商修改
    port: 587
    username: your-email@qq.com  # 修改为你的邮箱
    password: your-authorization-code  # 修改为你的授权码
    default-encoding: UTF-8
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000

# 应用配置
app:
  reset-password:
    url: http://localhost:8088/reset-password  # 密码重置页面URL（前端页面地址）
```

### 2. 测试邮件发送

启动应用后，可以通过以下接口测试：

```bash
POST /api/auth/password/reset
Content-Type: application/json

{
  "email": "test@example.com"
}
```

如果配置正确，系统会发送密码重置邮件到指定邮箱。

## 常见问题

### 1. 邮件发送失败

**可能原因：**
- SMTP服务器地址或端口配置错误
- 用户名或密码（授权码）错误
- 网络连接问题
- 邮箱服务商的安全限制

**解决方法：**
- 检查SMTP服务器地址和端口是否正确
- 确认使用的是授权码而不是登录密码
- 检查网络连接
- 查看应用日志获取详细错误信息

### 2. 本地环境无法发送邮件

**解决方法：**
- 确保配置了正确的SMTP服务器信息
- 使用真实邮箱的授权码（不是登录密码）
- 检查防火墙是否阻止了SMTP端口
- 某些邮件服务商可能需要先开启SMTP服务

### 3. 邮件进入垃圾箱

**可能原因：**
- 发件人邮箱未验证
- 邮件内容被识别为垃圾邮件

**解决方法：**
- 使用已验证的邮箱作为发件人
- 优化邮件内容，避免触发垃圾邮件过滤器

## 安全建议

1. **不要将授权码提交到代码仓库**
   - 使用环境变量或配置中心管理敏感信息
   - 生产环境使用环境变量：`${MAIL_PASSWORD:default-value}`

2. **使用专用邮箱**
   - 建议使用专门的应用邮箱，不要使用个人邮箱

3. **定期更换授权码**
   - 定期更换邮箱授权码，提高安全性

4. **限制发送频率**
   - 实现发送频率限制，防止滥用

## 环境变量配置（推荐）

生产环境建议使用环境变量：

```yaml
spring:
  mail:
    host: ${MAIL_HOST:smtp.qq.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}  # 从环境变量读取
```

然后在启动时设置环境变量：

```bash
export MAIL_HOST=smtp.qq.com
export MAIL_PORT=587
export MAIL_USERNAME=your-email@qq.com
export MAIL_PASSWORD=your-authorization-code
```

